# 基金筛选系统 - MVP技术方案

> **当前版本**：v1.2.0  
> **最后更新**：2026-02-17  
> **文档状态**：已确认

## 版本记录

| 版本 | 日期 | 修改内容 | 修改人 |
|------|------|---------|--------|
| v1.0.0 | 2026-02-17 | 初始版本，完成MVP核心功能（数据抓取、指标计算、筛选、回测、Server酱推送） | Claude |
| v1.1.0 | 2026-02-17 | 新增企业微信机器人推送支持，与Server酱并行使用 | Claude |
| v1.2.0 | 2026-02-17 | 新增邮件推送功能，支持SMTP协议发送报告 | Claude |

---

## 项目概述

**目标**：自用基金筛选工具，重点筛选稳健增长、长期复利的基金，支持定投策略  
**技术栈**：Python + SQLite/PostgreSQL + Server酱/企业微信  
**数据频率**：每周定时筛选推送一次  
**推送渠道**：Server酱（个人微信）+ 企业微信机器人（群推送）  

---

## 核心筛选逻辑

### 目标定位
- **A. 稳健增长**：每年都能正收益（月度胜率 > 60%）
- **C. 长期复利**：3年/5年累计收益高

### 筛选条件

#### 硬性门槛（必须满足）
- 成立时间 > 3年
- 基金规模 > 2亿
- 最大回撤 < 25%
- 夏普比率 > 0.8
- 近3年年化收益 > 5%

#### 多因子加权评分（总分100）
```python
score = (
    年化收益率_3年 * 30% +      # 长期收益能力
    夏普比率 * 25% +             # 风险调整后收益
    卡玛比率 * 20% +             # 收益/最大回撤
    月度胜率 * 15% +             # 稳健性
    最大回撤控制 * 10%           # 抗跌性
)
```

---

## 数据存储设计

### 数据表结构

| 表名 | 内容 | 更新频率 |
|------|------|---------|
| `funds` | 基金基础信息（代码、名称、类型、经理、成立日期、规模） | 每周 |
| `fund_nav` | 每日净值（OHLC） | 每日收盘后 |
| `fund_metrics` | 计算好的指标（年化收益、夏普比率、最大回撤、月度胜率、卡玛比率） | 每周 |
| `backtest_results` | 回测结果（持有3年/5年收益、基准对比） | 每周 |
| `selected_funds` | 本次筛选出的基金Top N | 每次运行 |

---

## 回测基准

| 基金类型 | 对比基准 |
|---------|---------|
| 股票型/混合型 | 沪深300指数 (000300.SH) |
| 债券型 | 中证全债指数 (H11001.CSI) |
| 指数增强型 | 对应的宽基指数 |

**回测输出**：
- 持有3年/5年的累计收益
- 年化收益
- 最大回撤
- 与基准的超额收益

---

## 技术架构

```
定时任务 (APScheduler)
    ↓
数据抓取 (AKShare) → SQLite/PostgreSQL
    ↓
指标计算 (pandas/numpy) → 筛选出Top N
    ↓
生成报告 (文字 + 图表) → MultiNotifier推送
    ↓
    ├─→ Server酱 → 个人微信
    └─→ 企业微信机器人 → 企业微信群
```

---

## 推送渠道配置

| 渠道 | 用途 | 获取方式 | 环境变量 |
|------|------|---------|---------|
| Server酱 | 推送到个人微信 | https://sct.ftqq.com/ | `SERVER_CHAN_KEY` |
| 企业微信机器人 | 推送到企业微信群 | 群设置 → 添加机器人 | `WECOM_WEBHOOK` |
| 邮件 | 推送到邮箱 | SMTP服务配置 | `SMTP_HOST`, `SMTP_USER`, `SMTP_PASSWORD`, `EMAIL_RECEIVER` |

**配置说明**：
- 三个渠道可同时配置，推送时会发送到所有已配置的渠道
- 至少配置一个渠道才能收到推送通知

**邮件配置示例**：
- Gmail: `SMTP_HOST=smtp.gmail.com`, `SMTP_PORT=587`, 需要应用专用密码
- QQ邮箱: `SMTP_HOST=smtp.qq.com`, `SMTP_PORT=587`, 使用授权码
- 163邮箱: `SMTP_HOST=smtp.163.com`, `SMTP_PORT=465`, 使用授权码

---

## 推送内容格式

```
📊 本周基金筛选报告（YYYY-MM-DD）

🥇 Top N 稳健复利基金：

1. 【基金名称】
   - 近3年收益: +XX.X% | 基准: +XX.X% ⬆️+XX.X%
   - 夏普比率: X.XX | 最大回撤: XX.X%
   - 综合评分: XX.X

2. 【基金名称】...

📈 详细图表: [点击查看]
⏰ 下次更新: YYYY-MM-DD
```

---

## 项目文件结构

```
fund-screener/
├── config/
│   ├── settings.py          # 配置（数据库、Server酱key、筛选参数）
│   └── requirements.txt     # Python依赖
├── data/
│   ├── fetcher.py           # AKShare数据抓取
│   ├── database.py          # 数据库连接和操作
│   └── models.py            # SQLAlchemy模型定义
├── analysis/
│   ├── indicators.py        # 指标计算（夏普、回撤、卡玛等）
│   ├── screener.py          # 筛选逻辑和打分算法
│   └── backtest.py          # 回测模块
├── report/
│   ├── generator.py         # 报告生成
│   └── notifier.py          # Server酱推送
├── main.py                  # 主入口，定时任务调度
└── README.md                # 项目说明
```

---

## 开发计划

| 天数 | 任务 |
|------|------|
| 1-2 | 搭建项目结构，配置PostgreSQL，实现数据抓取模块 |
| 3-4 | 实现指标计算（年化收益、夏普比率、最大回撤、卡玛比率、月度胜率） |
| 5-6 | 实现筛选逻辑和打分算法 |
| 7-8 | 实现回测模块（持有收益+基准对比） |
| 9-10 | 集成Server酱推送，测试定时任务 |

---

## 前置准备

1. **推送渠道**（至少配置一个）：
   - Server酱：访问 http://sc.ftqq.com 注册，获取SCKEY
   - 企业微信：在企业微信群中添加机器人，复制Webhook地址
2. **数据库**：SQLite（默认，无需安装）或 PostgreSQL
3. **Python环境**：Python 3.9+

---

*创建日期：2026-02-17*